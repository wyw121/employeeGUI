# VCFå¯¼å…¥åº”ç”¨é€‰æ‹©å™¨è‡ªåŠ¨å¤„ç†è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

å½“ä½ åœ¨Androidé›·ç”µæ¨¡æ‹Ÿå™¨ä¸Šé¦–æ¬¡å¯¼å…¥VCFæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šå¼¹å‡º"é€‰æ‹©åº”ç”¨"å¯¹è¯æ¡†ï¼Œè¯¢é—®ä½¿ç”¨å“ªä¸ªåº”ç”¨æ‰“å¼€VCFæ–‡ä»¶ã€‚ä½ éœ€è¦ï¼š
1. é€‰æ‹©é»˜è®¤é€šè®¯å½•åº”ç”¨
2. ç‚¹å‡»"å§‹ç»ˆ"æŒ‰é’®ï¼ˆè€Œä¸æ˜¯"ä»…ä¸€æ¬¡"ï¼‰

è¿™ä¸ªæ‰‹åŠ¨æ“ä½œåœ¨æ‰¹é‡å¯¼å…¥æ—¶å¾ˆéº»çƒ¦ï¼Œéœ€è¦è‡ªåŠ¨åŒ–å¤„ç†ã€‚

## è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ

æˆ‘å·²ç»ä¸ºä½ å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š

### æ–¹æ³•1ï¼šIntentç›´æ¥è°ƒç”¨ï¼ˆæ¨èï¼‰
- ğŸ¯ ç›´æ¥ä½¿ç”¨Android Intentè°ƒç”¨é€šè®¯å½•åº”ç”¨æ‰“å¼€VCFæ–‡ä»¶
- ğŸš€ ç»•è¿‡ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨ï¼Œé¿å…åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†
- âœ… æ— éœ€æ‰‹åŠ¨é€‰æ‹©åº”ç”¨

### æ–¹æ³•2ï¼šADB UIè‡ªåŠ¨åŒ–
- ğŸ” æ£€æµ‹åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†çš„å‡ºç°
- ğŸ“± è‡ªåŠ¨è¯†åˆ«å¹¶ç‚¹å‡»é€šè®¯å½•åº”ç”¨
- âœ… è‡ªåŠ¨ç‚¹å‡»"å§‹ç»ˆ"æŒ‰é’®

### æ–¹æ³•3ï¼šRootæƒé™é¢„è®¾ç½®
- ğŸ”§ ä½¿ç”¨Rootæƒé™é¢„å…ˆè®¾ç½®VCFæ–‡ä»¶çš„é»˜è®¤å…³è”åº”ç”¨
- âš¡ é¿å…åç»­å¼¹å‡ºé€‰æ‹©å™¨

## æŠ€æœ¯å®ç°

### 1. åç«¯Rustä»£ç 

#### æ–°å¢å‡½æ•°ï¼š
- `handle_app_chooser_dialog()` - å¤„ç†åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†
- `import_vcf_via_intent()` - ä½¿ç”¨Intentç›´æ¥æ‰“å¼€VCF
- `import_vcf_contacts_with_intent_fallback()` - Intent + ä¼ ç»Ÿæ–¹æ³•å›é€€

#### æ ¸å¿ƒé€»è¾‘ï¼š
```rust
// 1. æ£€æµ‹åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†
async fn has_app_chooser_dialog(&self, ui_content: &str) -> bool {
    let chooser_indicators = vec![
        "é€‰æ‹©åº”ç”¨", "ä½¿ç”¨ä»¥ä¸‹åº”ç”¨æ‰“å¼€", "æ‰“å¼€æ–¹å¼",
        "å§‹ç»ˆ", "ä»…ä¸€æ¬¡", "é€šè®¯å½•", "è”ç³»äºº"
    ];
    // æ£€æŸ¥UIä¸­æ˜¯å¦åŒ…å«è¿™äº›æŒ‡æ ‡
}

// 2. è‡ªåŠ¨ç‚¹å‡»é€šè®¯å½•åº”ç”¨å’Œ"å§‹ç»ˆ"æŒ‰é’®
async fn handle_app_chooser_dialog(&self) -> Result<()> {
    // æŸ¥æ‰¾é€šè®¯å½•åº”ç”¨åæ ‡å¹¶ç‚¹å‡»
    // æŸ¥æ‰¾"å§‹ç»ˆ"æŒ‰é’®åæ ‡å¹¶ç‚¹å‡»
}

// 3. Intentç›´æ¥è°ƒç”¨
async fn open_vcf_with_contacts_intent(&self, vcf_path: &str) -> Result<()> {
    // ä½¿ç”¨ am start -a android.intent.action.VIEW ç›´æ¥æ‰“å¼€
}
```

### 2. å‰ç«¯TypeScriptä»£ç 

#### æ–°å¢APIæ–¹æ³•ï¼š
```typescript
static async importVcfContactsWithIntentFallback(
    deviceId: string,
    contactsFilePath: string
): Promise<VcfImportResult>
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1ï¼šä½¿ç”¨æ–°çš„Intentæ–¹æ³•ï¼ˆæ¨èï¼‰

```typescript
import { ContactAPI } from '../api/ContactAPI';

// ä½¿ç”¨æ–°çš„Intent + å›é€€æ–¹æ³•
const result = await ContactAPI.importVcfContactsWithIntentFallback(
    "ä½ çš„è®¾å¤‡ID",
    "è”ç³»äººæ–‡ä»¶è·¯å¾„"
);

if (result.success) {
    console.log('å¯¼å…¥æˆåŠŸï¼', result);
} else {
    console.error('å¯¼å…¥å¤±è´¥ï¼š', result.message);
}
```

### æ–¹å¼2ï¼šåœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨

```typescript
import VcfImportWithAppChooserExample from '../examples/VcfImportWithAppChooserExample';

// åœ¨ä½ çš„ç»„ä»¶ä¸­
<VcfImportWithAppChooserExample
    deviceId="your-device-id"
    contactsFilePath="/path/to/contacts.txt"
/>
```

## è§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿

### 1. å¤šé‡ä¿éšœ
- **Intentæ–¹æ³•ä¼˜å…ˆ**ï¼šç›´æ¥è°ƒç”¨é€šè®¯å½•åº”ç”¨ï¼Œé¿å…é€‰æ‹©å™¨
- **UIè‡ªåŠ¨åŒ–å¤‡ä»½**ï¼šå¦‚æœIntentå¤±è´¥ï¼Œè‡ªåŠ¨å¤„ç†é€‰æ‹©å™¨å¯¹è¯æ¡†
- **ä¼ ç»Ÿæ–¹æ³•å…œåº•**ï¼šç¡®ä¿æ€»æœ‰ä¸€ç§æ–¹æ³•èƒ½æˆåŠŸ

### 2. æ™ºèƒ½æ£€æµ‹
- ğŸ” å®æ—¶æ£€æµ‹UIçŠ¶æ€
- ğŸ“± å‡†ç¡®è¯†åˆ«åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†
- âœ… æ™ºèƒ½å®šä½é€šè®¯å½•åº”ç”¨å’Œ"å§‹ç»ˆ"æŒ‰é’®

### 3. Rootæƒé™åˆ©ç”¨
- ğŸ”§ é¢„è®¾é»˜è®¤åº”ç”¨å…³è”
- âš¡ æå‡åç»­å¯¼å…¥æ•ˆç‡
- ğŸ›¡ï¸ å‡å°‘ç”¨æˆ·å¹²é¢„éœ€æ±‚

## å‘½ä»¤è¡Œæµ‹è¯•æ–¹æ³•

å¦‚æœä½ æƒ³æ‰‹åŠ¨æµ‹è¯•ADBå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

### 1. Intentç›´æ¥æ‰“å¼€VCFæ–‡ä»¶
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨é€šè®¯å½•åº”ç”¨ç›´æ¥æ‰“å¼€
adb -s your-device-id shell am start -a android.intent.action.VIEW -d "file:///sdcard/Download/contacts_import.vcf" -t "text/vcard" com.android.contacts

# æ–¹æ³•2ï¼šç³»ç»Ÿé»˜è®¤Intent
adb -s your-device-id shell am start -a android.intent.action.VIEW -d "file:///sdcard/Download/contacts_import.vcf" -t "text/vcard"
```

### 2. Rootæƒé™è®¾ç½®é»˜è®¤åº”ç”¨
```bash
# ä½¿ç”¨Rootæƒé™è®¾ç½®é»˜è®¤åº”ç”¨å…³è”
adb -s your-device-id shell su -c "pm set-app-link com.android.contacts always com.android.contacts"
```

### 3. UIè‡ªåŠ¨åŒ–æ£€æµ‹
```bash
# è·å–å½“å‰UIçŠ¶æ€
adb -s your-device-id shell uiautomator dump /sdcard/current_ui.xml
adb -s your-device-id shell cat /sdcard/current_ui.xml

# æ¨¡æ‹Ÿç‚¹å‡»ï¼ˆæ ¹æ®UIåˆ†æç»“æœè°ƒæ•´åæ ‡ï¼‰
adb -s your-device-id shell input tap x y
```

## æ•…éšœæ’é™¤

### 1. Intentæ–¹æ³•å¤±è´¥
- æ£€æŸ¥é€šè®¯å½•åº”ç”¨æ˜¯å¦å·²å®‰è£…
- ç¡®è®¤VCFæ–‡ä»¶è·¯å¾„æ­£ç¡®
- éªŒè¯æ–‡ä»¶æƒé™

### 2. UIè‡ªåŠ¨åŒ–å¤±è´¥
- æ£€æŸ¥UIAutomatoræ˜¯å¦æ­£å¸¸å·¥ä½œ
- éªŒè¯å±å¹•åæ ‡æ˜¯å¦å‡†ç¡®
- ç¡®è®¤è®¾å¤‡åˆ†è¾¨ç‡åŒ¹é…

### 3. Rootæƒé™é—®é¢˜
- ç¡®è®¤è®¾å¤‡å·²æ­£ç¡®Root
- æ£€æŸ¥ADBè¿æ¥çŠ¶æ€
- éªŒè¯suå‘½ä»¤å¯ç”¨

## æ—¥å¿—å’Œè°ƒè¯•

ç³»ç»Ÿä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
- ğŸš€ Intentæ–¹æ³•æ‰§è¡ŒçŠ¶æ€
- ğŸ” UIå¯¹è¯æ¡†æ£€æµ‹ç»“æœ
- ğŸ“± åæ ‡ç‚¹å‡»æ“ä½œè®°å½•
- âœ… å¯¼å…¥æˆåŠŸ/å¤±è´¥çŠ¶æ€

æŸ¥çœ‹æ—¥å¿—ä»¥äº†è§£å…·ä½“çš„æ‰§è¡Œæƒ…å†µå’Œå¯èƒ½çš„é—®é¢˜ã€‚

## æ€»ç»“

è¿™ä¸ªè§£å†³æ–¹æ¡ˆå®Œå…¨è‡ªåŠ¨åŒ–äº†VCFæ–‡ä»¶å¯¼å…¥è¿‡ç¨‹ä¸­çš„åº”ç”¨é€‰æ‹©å™¨å¤„ç†ï¼Œè®©ä½ å¯ä»¥ï¼š

1. âœ… **æ— éœ€æ‰‹åŠ¨é€‰æ‹©åº”ç”¨** - Intentç›´æ¥è°ƒç”¨é€šè®¯å½•
2. âœ… **è‡ªåŠ¨ç‚¹å‡»"å§‹ç»ˆ"** - UIè‡ªåŠ¨åŒ–å¤„ç†
3. âœ… **æ‰¹é‡å¯¼å…¥å‹å¥½** - ä¸€æ¬¡è®¾ç½®ï¼Œé•¿æœŸæœ‰æ•ˆ
4. âœ… **å¤šé‡ä¿éšœæœºåˆ¶** - ç¡®ä¿æˆåŠŸç‡
5. âœ… **åˆ©ç”¨Rootæƒé™** - è·å¾—æ›´å¥½çš„æ§åˆ¶èƒ½åŠ›

ä½ ç°åœ¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨æ–°çš„`importVcfContactsWithIntentFallback`æ–¹æ³•æ¥å¯¼å…¥VCFæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰çš„åº”ç”¨é€‰æ‹©å™¨å¯¹è¯æ¡†ï¼