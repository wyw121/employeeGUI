# æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾å™¨åŠŸèƒ½æ¨¡å—æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾å™¨æ˜¯ä¸€ä¸ªé€šç”¨çš„UIè‡ªåŠ¨åŒ–ç»„ä»¶ï¼Œä¸“é—¨ç”¨äºåœ¨Androidåº”ç”¨ä¸­æ™ºèƒ½è¯†åˆ«å¯¼èˆªæ å¹¶ç²¾ç¡®å®šä½ç‰¹å®šæŒ‰é’®ã€‚è¯¥åŠŸèƒ½ç‰¹åˆ«é’ˆå¯¹å°çº¢ä¹¦ç­‰åº”ç”¨çš„è‡ªåŠ¨åŒ–æ“ä½œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ”¯æŒå¤šç§å¯¼èˆªæ å¸ƒå±€ï¼ˆåº•éƒ¨ã€é¡¶éƒ¨ã€ä¾§è¾¹ã€æ‚¬æµ®ï¼‰ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- ğŸ¯ åŸºäºXMLç»“æ„æ™ºèƒ½è¯†åˆ«å¯¼èˆªæ åŒºåŸŸ
- ğŸ“± æ”¯æŒå¤šç§åº”ç”¨é¢„è®¾é…ç½®ï¼ˆå°çº¢ä¹¦ã€å¾®ä¿¡ã€æŠ–éŸ³ç­‰ï¼‰
- ğŸ¤– è‡ªåŠ¨åŒ–å…ƒç´ å®šä½å’Œäº¤äº’æ‰§è¡Œ
- ğŸ“Š å®æ—¶æ£€æµ‹ç»“æœå±•ç¤ºå’ŒéªŒè¯
- ğŸ”§ å¯é›†æˆåˆ°è„šæœ¬æ„å»ºå™¨ä¸­

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

### ğŸ¨ å‰ç«¯ç»„ä»¶ï¼ˆReact + TypeScriptï¼‰

#### **æ ¸å¿ƒç»„ä»¶**
```
src/components/smart-element-finder/
â”œâ”€â”€ SmartElementFinder.tsx          # ä¸»è¦çš„æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾ç»„ä»¶
â””â”€â”€ index.ts                        # ç»„ä»¶å¯¼å‡ºæ–‡ä»¶
```

#### **æµ‹è¯•é¡µé¢**
```
src/pages/
â””â”€â”€ SmartElementFinderTestPage.tsx  # åŠŸèƒ½æµ‹è¯•å’Œæ¼”ç¤ºé¡µé¢
```

### ğŸ¦€ åç«¯æœåŠ¡ï¼ˆRustï¼‰

#### **æ ¸å¿ƒæœåŠ¡**
```
src-tauri/src/services/
â”œâ”€â”€ smart_element_finder_service.rs # æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾æ ¸å¿ƒæœåŠ¡
â”œâ”€â”€ adb_service.rs                  # ADBæœåŠ¡æ‰©å±•ï¼ˆæ·»åŠ äº†æ–°æ–¹æ³•ï¼‰
â””â”€â”€ mod.rs                          # æœåŠ¡æ¨¡å—å£°æ˜
```

#### **ä¸»ç¨‹åºé›†æˆ**
```
src-tauri/src/
â””â”€â”€ main.rs                         # Tauriå‘½ä»¤æ³¨å†Œ
```

---

## ğŸ“ è¯¦ç»†æ–‡ä»¶è¯´æ˜

### ğŸ¨ å‰ç«¯ç»„ä»¶

#### **1. SmartElementFinder.tsx**
```typescript
è·¯å¾„: src/components/smart-element-finder/SmartElementFinder.tsx
åŠŸèƒ½: æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾å™¨ä¸»ç»„ä»¶
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **é¢„è®¾é…ç½®ç®¡ç†**: å†…ç½®å°çº¢ä¹¦ã€å¾®ä¿¡ã€æŠ–éŸ³ç­‰åº”ç”¨é…ç½®
- **æ™ºèƒ½æ£€æµ‹ç•Œé¢**: æä¾›å¯¼èˆªæ ç±»å‹é€‰æ‹©å’Œå‚æ•°é…ç½®
- **å®æ—¶ç»“æœå±•ç¤º**: æ˜¾ç¤ºæ£€æµ‹åˆ°çš„å…ƒç´ åˆ—è¡¨å’Œç›®æ ‡æŒ‰é’®
- **äº¤äº’æµ‹è¯•åŠŸèƒ½**: æ”¯æŒå…ƒç´ ç‚¹å‡»å’Œæ­¥éª¤åˆ›å»º

**ä¸»è¦æ¥å£ï¼š**
```typescript
interface NavigationBarConfig {
    position_type: 'bottom' | 'top' | 'side' | 'floating';
    position_ratio?: {
        x_start: number; x_end: number;
        y_start: number; y_end: number;
    };
    button_count?: number;
    button_patterns: string[];
    target_button: string;
    click_action: 'single_tap' | 'double_tap' | 'long_press';
}
```

**é¢„è®¾é…ç½®ç¤ºä¾‹ï¼š**
```typescript
'å°çº¢ä¹¦_åº•éƒ¨å¯¼èˆª': {
    position_type: 'bottom',
    position_ratio: { x_start: 0.0, x_end: 1.0, y_start: 0.93, y_end: 1.0 },
    button_count: 5,
    button_patterns: ['é¦–é¡µ', 'å¸‚é›†', 'å‘å¸ƒ', 'æ¶ˆæ¯', 'æˆ‘'],
    target_button: 'æˆ‘',
    click_action: 'single_tap'
}
```

#### **2. SmartElementFinderTestPage.tsx**
```typescript
è·¯å¾„: src/pages/SmartElementFinderTestPage.tsx
åŠŸèƒ½: åŠŸèƒ½æµ‹è¯•å’Œæ¼”ç¤ºé¡µé¢
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **è®¾å¤‡ç®¡ç†**: è‡ªåŠ¨æ£€æµ‹å’Œé€‰æ‹©è¿æ¥çš„Androidè®¾å¤‡
- **ç»„ä»¶é›†æˆ**: å®Œæ•´çš„SmartElementFinderç»„ä»¶æ¼”ç¤º
- **ä½¿ç”¨æŒ‡å—**: è¯¦ç»†çš„æ“ä½œæ­¥éª¤å’ŒåŠŸèƒ½è¯´æ˜
- **æµ‹è¯•æµç¨‹**: æä¾›å®Œæ•´çš„æµ‹è¯•æ­¥éª¤æŒ‡å¯¼

### ğŸ¦€ åç«¯æœåŠ¡

#### **3. smart_element_finder_service.rs**
```rust
è·¯å¾„: src-tauri/src/services/smart_element_finder_service.rs
åŠŸèƒ½: æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾æ ¸å¿ƒæœåŠ¡
```

**æ ¸å¿ƒç»“æ„ï¼š**
```rust
pub struct SmartElementFinderService {
    adb_service: AdbService,
}
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `smart_element_finder()`: æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾ä¸»æ–¹æ³•
- `click_detected_element()`: ç‚¹å‡»æ£€æµ‹åˆ°çš„å…ƒç´ 
- `parse_navigation_elements()`: è§£æå¯¼èˆªåŒºåŸŸå†…çš„å…ƒç´ 
- `is_navigation_button()`: åˆ¤æ–­æ˜¯å¦ä¸ºå¯¼èˆªæŒ‰é’®
- `is_target_button()`: åˆ¤æ–­æ˜¯å¦ä¸ºç›®æ ‡æŒ‰é’®

**æ ¸å¿ƒç®—æ³•ï¼š**
1. **å±å¹•å°ºå¯¸è·å–**: `get_screen_size()`
2. **UIå±‚æ¬¡ç»“æ„è·å–**: `dump_ui_hierarchy()`
3. **åŒºåŸŸåŒ¹é…**: `is_in_region()` - åŸºäºå±å¹•æ¯”ä¾‹å®šä½
4. **å…ƒç´ è§£æ**: `parse_ui_element_from_line()` - XMLè¡Œè§£æ
5. **åæ ‡è®¡ç®—**: `calculate_center_position()` - å…ƒç´ ä¸­å¿ƒç‚¹è®¡ç®—

**Tauriå‘½ä»¤æ¥å£ï¼š**
```rust
#[command]
pub async fn smart_element_finder(
    device_id: String,
    config: NavigationBarConfig,
    adb_service: tauri::State<'_, std::sync::Mutex<AdbService>>,
) -> Result<ElementFinderResult, String>

#[command]
pub async fn click_detected_element(
    device_id: String,
    element: DetectedElement,
    click_type: String,
    adb_service: tauri::State<'_, std::sync::Mutex<AdbService>>,
) -> Result<ClickResult, String>
```

#### **4. adb_service.rsï¼ˆæ‰©å±•ï¼‰**
```rust
è·¯å¾„: src-tauri/src/services/adb_service.rs
åŠŸèƒ½: ADBæœåŠ¡æ‰©å±•
ä¿®æ”¹ç±»å‹: æ–°å¢æ–¹æ³•
```

**æ–°å¢æ–¹æ³•ï¼š**
```rust
// ä¸ºAdbServiceæ·»åŠ Clone trait
#[derive(Clone)]
pub struct AdbService;

// å¼‚æ­¥ADBå‘½ä»¤æ‰§è¡Œ
pub async fn execute_adb_command(&self, device_id: &str, command: &str) -> Result<String, Box<dyn std::error::Error>>

// UIå±‚æ¬¡ç»“æ„è·å–
pub async fn dump_ui_hierarchy(&self, device_id: &str) -> Result<String, Box<dyn std::error::Error>>
```

### ğŸ”§ é…ç½®æ–‡ä»¶

#### **5. main.rsï¼ˆé›†æˆï¼‰**
```rust
è·¯å¾„: src-tauri/src/main.rs
åŠŸèƒ½: Tauriå‘½ä»¤æ³¨å†Œ
ä¿®æ”¹ç±»å‹: æ·»åŠ å¯¼å…¥å’Œå‘½ä»¤æ³¨å†Œ
```

**æ·»åŠ çš„å¯¼å…¥ï¼š**
```rust
use services::smart_element_finder_service::{smart_element_finder, click_detected_element};
```

**æ·»åŠ çš„å‘½ä»¤æ³¨å†Œï¼š**
```rust
.invoke_handler(tauri::generate_handler![
    // ...å…¶ä»–å‘½ä»¤...
    // æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾åŠŸèƒ½
    smart_element_finder,    // æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾
    click_detected_element   // ç‚¹å‡»æ£€æµ‹åˆ°çš„å…ƒç´ 
])
```

#### **6. mod.rsï¼ˆæœåŠ¡æ¨¡å—ï¼‰**
```rust
è·¯å¾„: src-tauri/src/services/mod.rs
åŠŸèƒ½: æœåŠ¡æ¨¡å—å£°æ˜
ä¿®æ”¹ç±»å‹: æ·»åŠ æ¨¡å—å£°æ˜
```

**æ·»åŠ çš„æ¨¡å—å£°æ˜ï¼š**
```rust
pub mod smart_element_finder_service;  // æ–°å¢ï¼šæ™ºèƒ½å…ƒç´ æŸ¥æ‰¾æœåŠ¡
```

#### **7. AntDesignDemo.tsxï¼ˆç•Œé¢é›†æˆï¼‰**
```typescript
è·¯å¾„: src/components/AntDesignDemo.tsx
åŠŸèƒ½: ä¸»ç•Œé¢èœå•é›†æˆ
ä¿®æ”¹ç±»å‹: æ·»åŠ èœå•é¡¹å’Œé¡µé¢æ¸²æŸ“
```

**æ·»åŠ çš„èœå•é¡¹ï¼š**
```typescript
{
  key: 'smart-element-finder',
  icon: <AimOutlined />,
  label: 'æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾',
}
```

**æ·»åŠ çš„é¡µé¢æ¸²æŸ“ï¼š**
```typescript
{selectedKey === 'smart-element-finder' && (
  <SmartElementFinderTestPage />
)}
```

---

## ğŸ”„ æ•°æ®æµç¨‹å›¾

```mermaid
graph TD
    A[å‰ç«¯ç»„ä»¶SmartElementFinder] --> B[é€‰æ‹©é¢„è®¾é…ç½®]
    B --> C[é…ç½®å¯¼èˆªæ å‚æ•°]
    C --> D[è°ƒç”¨Tauriå‘½ä»¤]
    D --> E[smart_element_finder_service.rs]
    E --> F[è·å–å±å¹•å°ºå¯¸]
    F --> G[è·å–UIå±‚æ¬¡ç»“æ„XML]
    G --> H[è§£æå¯¼èˆªåŒºåŸŸå…ƒç´ ]
    H --> I[åŒ¹é…ç›®æ ‡æŒ‰é’®]
    I --> J[è¿”å›æ£€æµ‹ç»“æœ]
    J --> K[å‰ç«¯æ˜¾ç¤ºç»“æœ]
    K --> L[ç”¨æˆ·ç‚¹å‡»æµ‹è¯•]
    L --> M[è°ƒç”¨click_detected_element]
    M --> N[æ‰§è¡ŒADBç‚¹å‡»å‘½ä»¤]
    N --> O[è¿”å›æ‰§è¡Œç»“æœ]
```

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### **åŸºæœ¬æµ‹è¯•æ­¥éª¤ï¼š**

1. **ç¯å¢ƒå‡†å¤‡**
   ```bash
   # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   npm run tauri dev
   ```

2. **è®¾å¤‡è¿æ¥**
   - ç¡®ä¿Androidè®¾å¤‡å·²è¿æ¥
   - å¯ç”¨USBè°ƒè¯•æ¨¡å¼
   - æ‰“å¼€ç›®æ ‡åº”ç”¨ï¼ˆå¦‚å°çº¢ä¹¦ï¼‰

3. **åŠŸèƒ½æµ‹è¯•**
   - è®¿é—®"æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾"é¡µé¢
   - é€‰æ‹©è¿æ¥çš„è®¾å¤‡
   - é€‰æ‹©é¢„è®¾é…ç½®"å°çº¢ä¹¦_åº•éƒ¨å¯¼èˆª"
   - è®¾ç½®ç›®æ ‡æŒ‰é’®ä¸º"æˆ‘"
   - ç‚¹å‡»"æ™ºèƒ½æ£€æµ‹"
   - éªŒè¯æ£€æµ‹ç»“æœ
   - ç‚¹å‡»"ç‚¹å‡»å…ƒç´ "æµ‹è¯•äº¤äº’

### **é¢„æœŸç»“æœï¼š**
```json
{
  "success": true,
  "message": "æˆåŠŸæ‰¾åˆ°ç›®æ ‡æŒ‰é’®'æˆ‘'",
  "found_elements": [
    {"text": "é¦–é¡µ", "bounds": "[0,1785][216,1920]"},
    {"text": "å¸‚é›†", "bounds": "[216,1785][432,1920]"},
    {"text": "å‘å¸ƒ", "bounds": "[432,1785][648,1920]"},
    {"text": "æ¶ˆæ¯", "bounds": "[648,1785][864,1920]"},
    {"text": "æˆ‘", "bounds": "[864,1785][1080,1920]"}
  ],
  "target_element": {
    "text": "æˆ‘",
    "bounds": "[864,1785][1080,1920]",
    "position": [972, 1852]
  }
}
```

---

## ğŸ› ï¸ ç»´æŠ¤æŒ‡å—

### **å¸¸è§é—®é¢˜æ’æŸ¥ï¼š**

1. **ç¼–è¯‘é”™è¯¯**
   ```bash
   # æ£€æŸ¥Ruståç«¯ç¼–è¯‘
   cd src-tauri && cargo check
   
   # æ£€æŸ¥å‰ç«¯ç¼–è¯‘
   npm run build
   ```

2. **è®¾å¤‡è¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥ADBè¿æ¥
   adb devices
   
   # é‡å¯ADBæœåŠ¡
   adb kill-server && adb start-server
   ```

3. **UIæ£€æµ‹å¤±è´¥**
   - æ£€æŸ¥åº”ç”¨æ˜¯å¦åœ¨å‰å°
   - éªŒè¯UIå±‚æ¬¡ç»“æ„æ˜¯å¦æ­£ç¡®è·å–
   - ç¡®è®¤å¯¼èˆªæ ä½ç½®é…ç½®æ˜¯å¦å‡†ç¡®

### **æ‰©å±•æ–°åº”ç”¨æ”¯æŒï¼š**

1. **æ·»åŠ é¢„è®¾é…ç½®**
   ```typescript
   // åœ¨SmartElementFinder.tsxä¸­æ·»åŠ 
   'æ–°åº”ç”¨_åº•éƒ¨å¯¼èˆª': {
     position_type: 'bottom',
     position_ratio: { x_start: 0.0, x_end: 1.0, y_start: 0.9, y_end: 1.0 },
     button_count: 4,
     button_patterns: ['é¦–é¡µ', 'å‘ç°', 'æ¶ˆæ¯', 'æˆ‘'],
     target_button: 'æˆ‘',
     click_action: 'single_tap'
   }
   ```

2. **æµ‹è¯•æ–°é…ç½®**
   - è¿æ¥è®¾å¤‡å¹¶æ‰“å¼€ç›®æ ‡åº”ç”¨
   - é€‰æ‹©æ–°çš„é¢„è®¾é…ç½®
   - è¿›è¡Œæ£€æµ‹æµ‹è¯•
   - æ ¹æ®ç»“æœè°ƒæ•´å‚æ•°

### **æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š**

1. **XMLè§£æä¼˜åŒ–**
   - ä½¿ç”¨æ­£è§„XMLè§£æå™¨æ›¿ä»£å­—ç¬¦ä¸²åŒ¹é…
   - æ·»åŠ è§£æç¼“å­˜æœºåˆ¶
   - ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

2. **é”™è¯¯å¤„ç†å¢å¼º**
   - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
   - å®ç°é‡è¯•æœºåˆ¶
   - æ·»åŠ è¶…æ—¶æ§åˆ¶

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ æ£€æµ‹è¿›åº¦æŒ‡ç¤º
   - å®ç°ç»“æœå¯è§†åŒ–é¢„è§ˆ
   - æ·»åŠ é…ç½®ä¿å­˜åŠŸèƒ½

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ADBæ¶æ„ç»Ÿä¸€æ€§è§„èŒƒ](./ADB_ARCHITECTURE_STANDARDS.md)
- [é¡¹ç›®README](./README.md)
- [å¼€å‘å·¥ä½œæµç¨‹](./DEVELOPMENT_WORKFLOW.md)

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´9æœˆ17æ—¥  
**ç‰ˆæœ¬**: v1.0.0  
**ç»´æŠ¤è€…**: AI Assistant  
**æœ€åæ›´æ–°**: æ™ºèƒ½å…ƒç´ æŸ¥æ‰¾å™¨åŠŸèƒ½å®Œæ•´å®ç°